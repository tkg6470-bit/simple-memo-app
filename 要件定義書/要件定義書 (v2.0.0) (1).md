### ---

**1\. 要件定義書 (v2.0.0)**

Hono RPC の導入によるアーキテクチャの変更と、MinIO を用いたローカル環境の仕様を明記しました。

\# \---

**\*\*1. 📋 要件定義書 (v2.0.0)\*\***

**\*\*変更点:\*\***

\* **\*\*バージョン 2.0.0 (Major Update)\*\***: Hono RPC 導入による「End-to-End 型安全性」の確立に伴いメジャーバージョンアップ。  
\* **\*\*5. システム設計詳細\*\***:  
    \* Backend と Frontend の結合方式を **\*\*Hono RPC\*\*** に変更。  
    \* ローカルストレージとして **\*\*MinIO\*\*** を正式採用。  
\* **\*\*6. 開発運用ルール\*\***: 環境変数によるストレージURLの書き換えロジック（Localhost対応）を定義。

\# **\*\*📋 要件定義書 (System Requirements Specification)\*\***

Project Name: Simple Memo App (Ultimate Edition)

Version: 2.0.0 (End-to-End Type Safety Edition)

本ドキュメントは、モダンな自社開発企業が採用する技術スタックと開発フローを再現した、フルスタックメモアプリケーションの要件を定義するものである。  
v2.0.0では、**\*\*Hono RPC\*\*** を導入し、バックエンドとフロントエンドの間で完全な型安全性を実現した。

\#\# **\*\*1. プロジェクト概要\*\***

\#\#\# **\*\*1.1 目的\*\***

\* **\*\*技術力の証明\*\***: モダン技術（TypeScript, Docker, Cloud-Native, AI 連携）に加え、**\*\*Hono RPC による型安全な通信\*\*** と **\*\*Docker Compose による完全なローカル開発環境\*\*** を構築・運用する能力を証明する。

\#\#\# **\*\*1.2 予算戦略\*\***

\* **\*\*開発・運用フェーズ\*\***: 完全無料  
    \* **\*\*Compute\*\***: Render (Free Tier) \- Docker コンテナ実行  
    \* **\*\*Database\*\***: Supabase (Free Tier) \- PostgreSQL  
    \* **\*\*Storage\*\***:   
        \* Production: Supabase Storage (Free Tier)  
        \* Local: **\*\*MinIO\*\*** (Docker)  
    \* **\*\*Auth\*\***: Clerk (Free Tier)  
    \* **\*\*CI/CD\*\***: GitHub Actions (Free Tier)

\#\# **\*\*2. 機能要件 (Functional Requirements)\*\***

\#\#\# **\*\*2.1 基本機能 (Core Features)\*\***

| ID | 機能名 | 実装状況 | 詳細 |  
| :--- | :--- | :--- | :--- |  
| **\*\*F-01\*\*** | **\*\*メモ作成\*\*** | ✅ 完了 | タイトル・本文・**\*\*画像\*\***を入力し保存する。画像は環境に応じて **\*\*MinIO/Supabase\*\*** へ振り分け保存。 |  
| **\*\*F-02\*\*** | **\*\*メモ閲覧\*\*** | ✅ 完了 | 作成日順での一覧表示。 |  
| **\*\*F-03\*\*** | **\*\*メモ削除\*\*** | ✅ 完了 | 不要なメモを削除する。 |  
| **\*\*F-04\*\*** | **\*\*メモ編集\*\*** | 未実施 | タイトル・本文・画像の更新に対応。 |

\#\#\# **\*\*2.2 認証・認可 (Auth)\*\***

| ID | 機能名 | 実装状況 | 詳細 |  
| :--- | :--- | :--- | :--- |  
| **\*\*F-05\*\*** | **\*\*ユーザー登録/ログイン\*\*** | ✅ 完了 | **\*\*Clerk\*\*** を用いたセキュアな認証。 |  
| **\*\*F-06\*\*** | **\*\*データ分離\*\*** | ✅ 完了 | userId によるアクセス制御。 |

\#\#\# **\*\*2.3 AI・高度機能 (Advanced Features)\*\***

| ID | 機能名 | 実装状況 | 詳細 |  
| :--- | :--- | :--- | :--- |  
| **\*\*F-07\*\*** | **\*\*AI 自動要約\*\*** | ✅ 完了 | OpenAI API (Mock可) を利用し、長文メモを要約保存する。 |  
| **\*\*F-08\*\*** | **\*\*ベクトル検索 (RAG)\*\*** | ✅ 完了 | **\*\*pgvector\*\*** を利用し、意味検索を実現する。 |

\#\# **\*\*3. 非機能要件 (Non-Functional Requirements)\*\***

\#\#\# **\*\*3.1 セキュリティ & インフラ\*\***

\* **\*\*機密情報\*\***: .env 管理を徹底。  
\* **\*\*入力値検証\*\***: Zod による厳格なバリデーションを実施。  
\* **\*\*可用性\*\***:  
    \* **\*\*Render\*\***: Docker ベースの Web Service。  
    \* **\*\*Docker Compose\*\***: \`restart: always\` および ヘルスチェックによる安定稼働。

\#\#\# **\*\*3.2 品質・保守性\*\***

\* **\*\*End-to-End 型安全性 (New)\*\***:  
    \* Hono RPC (\`hc\<AppType\>\`) を使用し、APIのエンドポイント・リクエスト・レスポンスの型をフロントエンドと共有する。  
    \* フロントエンド側での手動型定義 (\`interface Memo ...\`) を廃止し、バックエンドの型を信頼源とする。  
\* **\*\*自動化 (CI)\*\***: GitHub Actions により、Lint と Type Check を自動実行する。

\#\#\# **\*\*3.3 パフォーマンス目標\*\***

\* **\*\*API レスポンス\*\***: 通常の CRUD 操作は **\*\*500ms 以内\*\*** にレスポンスを返すこと。

\#\# **\*\*4. UI/UX ガイドライン\*\***

(変更なし)

\#\# **\*\*5. システム設計詳細 (System Design)\*\***

\#\#\# **\*\*5.1 技術スタック\*\***

\* **\*\*Frontend\*\***: React (Vite), **\*\*Hono Client (RPC)\*\***, Clerk SDK  
\* **\*\*Backend\*\***: **\*\*Node.js (Hono)\*\***, Prisma, OpenAI SDK  
\* **\*\*Database\*\***: **\*\*Supabase (PostgreSQL 16)\*\*** (pgvector enabled)  
\* **\*\*Storage\*\***:   
    \* **\*\*Local\*\***: **\*\*MinIO\*\*** (S3 Compatible)  
    \* **\*\*Prod\*\***: **\*\*Supabase Storage\*\***  
\* **\*\*Infrastructure\*\***: Docker Compose (Local), **\*\*Render\*\*** (Prod)

\#\#\# **\*\*5.2 データモデル (ER Diagram)\*\***

(変更なし)

\#\#\# **\*\*5.3 ディレクトリ構成 & 主要アーキテクチャ\*\***

型定義の循環参照を防ぐため、以下の分離を徹底する。

\* **\*\*backend/src/app.ts\*\***: ルート定義のみを行い、型定義 (\`AppType\`) をエクスポートする。  
\* **\*\*backend/src/index.ts\*\***: サーバー起動設定（ミドルウェア適用、ポート待受）を行う。  
\* **\*\*frontend/src/client.ts\*\***: \`hc\<AppType\>\` を初期化し、型安全なクライアントを生成する。

\#\#\# **\*\*5.4 API インターフェース (Hono RPC)\*\***

REST APIのエンドポイントは Hono RPC により以下のように抽象化される。

\* \`client.api.memos.$get()\`  
\* \`client.api.memos.$post({ form: ... })\`  
\* \`client.api.memos.search.$get({ query: ... })\`

\#\# **\*\*6. 開発運用ルール\*\***

\#\#\# **\*\*6.1 環境分離 (Environment Isolation)\*\***

\* **\*\*Docker 運用\*\***:  
    \* バックエンドは \`npm run dev\` コマンドでコンテナ起動時に自動立ち上げを行う。  
    \* MinIO バケットは初期化コンテナにより自動作成・公開設定を行う。

\#\#\# **\*\*6.2 画像URLハンドリング (New)\*\***

ローカル開発 (MinIO) と本番環境 (Supabase) の差異を吸収するため、バックエンドで以下の変換を行う。

1\.  **\*\*環境変数判定\*\***: \`AWS\_ENDPOINT\` が \`minio\` を含むか確認。  
2\.  **\*\*ローカルの場合\*\***: ブラウザからアクセス可能な \`http://localhost:9000\` に置換してURLを保存/返却する。  
3\.  **\*\*本番の場合\*\***: パブリックなストレージURL形式に置換する。

\#\#\# **\*\*6.3 CI/CD パイプライン\*\***

\* **\*\*GitHub Actions\*\***: Lint, TypeCheck の通過を必須とする。

Created by \[tkg\] \- 2025  
