### **1\. 📘 要件定義書 (v2.1.0)**

**主な変更点:**

* **バージョンアップ:** インフラのコード化完了に伴い v2.1.0 へ更新。  
* **3.1 セキュリティ & インフラ:** render.yaml による構成管理（IaC）を明記。  
* **5.1 技術スタック:** インフラ管理に「Render Blueprint (IaC)」を追加。  
* **6\. 開発運用ルール:** 「機密情報の分離管理（Dashboard vs YAML）」のルールを追加。

Markdown

\# \---

**\*\*1. 📋 要件定義書 (v2.1.0)\*\***

**\*\*変更点:\*\***

\* **\*\*バージョン 2.1.0 (IaC & Deployment Completed)\*\***: Render Blueprint (\`render.yaml\`) によるインフラ自動化と、本番環境での稼働実績を反映。  
\* **\*\*3.1 セキュリティ & インフラ\*\***: インフラ構成管理をコードベース (\`render.yaml\`) に移行。  
\* **\*\*6. 開発運用ルール\*\***: 機密情報 (Secrets) と設定情報 (Config) の分離ルールを策定。

\# **\*\*📋 要件定義書 (System Requirements Specification)\*\***

Project Name: Simple Memo App (Ultimate Edition)

Version: 2.1.0 (IaC & Deployment Ready Edition)

本ドキュメントは、モダンな自社開発企業が採用する技術スタックと開発フローを再現した、フルスタックメモアプリケーションの要件を定義するものである。  
v2.1.0では、**\*\*Infrastructure as Code (IaC)\*\*** を導入し、インフラ構築の自動化と再現性を確立した。

\#\# **\*\*1. プロジェクト概要\*\***

\#\#\# **\*\*1.1 目的\*\***

\* **\*\*技術力の証明\*\***: モダン技術（TypeScript, Docker, Cloud-Native, AI 連携）に加え、**\*\*Hono RPC による型安全な通信\*\*** と **\*\*Render Blueprint によるインフラ自動化\*\*** を運用する能力を証明する。

\#\#\# **\*\*1.2 予算戦略\*\***

\* **\*\*開発・運用フェーズ\*\***: 完全無料  
    \* **\*\*Compute\*\***: Render (Free Tier) \- Docker コンテナ実行 (Managed by \`render.yaml\`)  
    \* **\*\*Database\*\***: Supabase (Free Tier) \- PostgreSQL  
    \* **\*\*Storage\*\***:   
        \* Production: Supabase Storage (Free Tier)  
        \* Local: **\*\*MinIO\*\*** (Docker)  
    \* **\*\*Auth\*\***: Clerk (Free Tier)  
    \* **\*\*CI/CD\*\***: GitHub Actions (Free Tier)

\#\# **\*\*2. 機能要件 (Functional Requirements)\*\***

\#\#\# **\*\*2.1 基本機能 (Core Features)\*\***

| ID | 機能名 | 実装状況 | 詳細 |  
| :--- | :--- | :--- | :--- |  
| **\*\*F-01\*\*** | **\*\*メモ作成\*\*** | ✅ 完了 | タイトル・本文・**\*\*画像\*\***を入力し保存する。画像は環境に応じて **\*\*MinIO/Supabase\*\*** へ振り分け保存。 |  
| **\*\*F-02\*\*** | **\*\*メモ閲覧\*\*** | ✅ 完了 | 作成日順での一覧表示。 |  
| **\*\*F-03\*\*** | **\*\*メモ削除\*\*** | ✅ 完了 | 不要なメモを削除する。 |  
| **\*\*F-04\*\*** | **\*\*メモ編集\*\*** | 🟡 着手前 | タイトル・本文・画像の更新に対応。（※Next Task） |

\#\#\# **\*\*2.2 認証・認可 (Auth)\*\***

| ID | 機能名 | 実装状況 | 詳細 |  
| :--- | :--- | :--- | :--- |  
| **\*\*F-05\*\*** | **\*\*ユーザー登録/ログイン\*\*** | ✅ 完了 | **\*\*Clerk\*\*** を用いたセキュアな認証。 |  
| **\*\*F-06\*\*** | **\*\*データ分離\*\*** | ✅ 完了 | userId によるアクセス制御。 |

\#\#\# **\*\*2.3 AI・高度機能 (Advanced Features)\*\***

| ID | 機能名 | 実装状況 | 詳細 |  
| :--- | :--- | :--- | :--- |  
| **\*\*F-07\*\*** | **\*\*AI 自動要約\*\*** | ✅ 完了 | OpenAI API (Mock可) を利用し、長文メモを要約保存する。 |  
| **\*\*F-08\*\*** | **\*\*ベクトル検索 (RAG)\*\*** | ✅ 完了 | **\*\*pgvector\*\*** を利用し、意味検索を実現する。 |

\#\# **\*\*3. 非機能要件 (Non-Functional Requirements)\*\***

\#\#\# **\*\*3.1 セキュリティ & インフラ\*\***

\* **\*\*IaC (Infrastructure as Code)\*\***: \`render.yaml\` によりサービス構成（Web Service, Docker設定, 環境変数リンク）をコード管理する。  
\* **\*\*機密情報\*\***: APIキーやDB接続情報はコードに含めず、Render Dashboard の **\*\*Environment Groups\*\*** で管理する。  
\* **\*\*可用性\*\***:  
    \* **\*\*Docker\*\***: \`npm run build\` によるビルドと、起動時の自動マイグレーション (\`prisma migrate deploy\`) を実装。

\#\#\# **\*\*3.2 品質・保守性\*\***

\* **\*\*End-to-End 型安全性\*\***:  
    \* \`tsconfig.json\` のパス解決（\`paths\`）を最適化し、モノレポ構成下でのバックエンド/フロントエンド間の型共有を確立。  
\* **\*\*自動化 (CI)\*\***: GitHub Actions により、Lint と Type Check を自動実行する。

\#\#\# **\*\*3.3 パフォーマンス目標\*\***

\* **\*\*API レスポンス\*\***: 通常の CRUD 操作は **\*\*500ms 以内\*\*** にレスポンスを返すこと。

\#\# **\*\*4. UI/UX ガイドライン\*\***

(変更なし)

\#\# **\*\*5. システム設計詳細 (System Design)\*\***

\#\#\# **\*\*5.1 技術スタック\*\***

\* **\*\*Frontend\*\***: React (Vite), **\*\*Hono Client (RPC)\*\***, Clerk SDK  
\* **\*\*Backend\*\***: **\*\*Node.js (Hono)\*\***, Prisma (v5.22.0 Fixed), OpenAI SDK  
\* **\*\*Database\*\***: **\*\*Supabase (PostgreSQL 16)\*\*** (pgvector enabled)  
\* **\*\*Infrastructure\*\***:   
    \* Local: Docker Compose  
    \* Prod: **\*\*Render Blueprint (IaC)\*\***  
\* **\*\*Storage\*\***: MinIO (Local) / Supabase Storage (Prod)

\#\#\# **\*\*5.2 データモデル (ER Diagram)\*\***

(変更なし)

\#\#\# **\*\*5.3 ディレクトリ構成 & 主要アーキテクチャ\*\***

\* **\*\*\`render.yaml\`\*\***: ルートディレクトリに配置し、バックエンド・フロントエンド双方のビルドコンテキストを制御する。  
\* **\*\*\`frontend/src/client.ts\`\*\***: 環境変数 (\`VITE\_API\_URL\`) の正規化処理（末尾スラッシュ除去など）を実装し、接続エラーを防止。

\#\#\# **\*\*5.4 API インターフェース (Hono RPC)\*\***

(変更なし)

\#\# **\*\*6. 開発運用ルール\*\***

\#\#\# **\*\*6.1 環境分離 (Environment Isolation)\*\***

\* **\*\*Docker 運用\*\***:  
    \* バックエンドは \`npm run dev\` コマンドでコンテナ起動時に自動立ち上げを行う。  
    \* Render環境では \`Dockerfile\` に基づき \`dist\` 生成とマイグレーションを自動実行する。

\#\#\# **\*\*6.2 シークレット管理 (New)\*\***

\* **\*\*Config (非機密)\*\***: \`render.yaml\` に記述（\`NODE\_ENV\`, \`PORT\` 等）。  
\* **\*\*Secrets (機密)\*\***: Render Dashboard の Environment Groups に記述（\`DATABASE\_URL\`, \`AWS\_ACCESS\_KEY\_ID\` 等）。  
\* **\*\*禁止事項\*\***: \`.env\` ファイルや \`render.yaml\` に生のシークレット値をコミットしない。

\#\#\# **\*\*6.3 CI/CD パイプライン\*\***

\* **\*\*GitHub Actions\*\***: PR/Push 時に品質チェックを実行。  
\* **\*\*Render Auto Deploy\*\***: \`main\` ブランチへのマージをトリガーに、\`render.yaml\` の定義に従って自動デプロイ。

Created by \[tkg\] \- 2025

