# **📋 要件定義書 (System Requirements Specification)**

Project Name: Simple Memo App (Enhanced Edition)

Version: 1.7.1 (AWS Environment Refined)

本ドキュメントは、モダンな自社開発企業が採用する技術スタックと開発フローを再現した、フルスタックメモアプリケーションの要件を定義するものである。

## **1\. プロジェクト概要**

### **1.1 目的**

* **技術力の証明**: 未経験から即戦力レベルのモダン技術（TypeScript, Docker, AWS, AI 連携）に加え、**Dev Containers を用いた高度な環境構築能力**を証明する。

### **1.2 予算戦略**

* **開発フェーズ**: 完全無料 (Docker Desktop, MinIO, Clerk Free Tier 利用)  
* **運用フェーズ**:  
  * AWS App Runner はデモ時以外サービスを削除し、コストを最小化する。  
  * **Amazon RDS は使用時以外「一時停止」し、課金を防ぐ運用を徹底する。**

## **2\. 機能要件 (Functional Requirements)**

### **2.1 基本機能 (Core Features)**

| ID | 機能名 | 実装状況 | 詳細 |
| :---- | :---- | :---- | :---- |
| **F-01** | **メモ作成** | ✅ 完了 | タイトル・本文・**画像**を入力し保存する（ベクトル自動生成含む）。 |
| **F-02** | **メモ閲覧** | ✅ 完了 | 作成日順での一覧表示。 |
| **F-03** | **メモ削除** | ✅ 完了 | 不要なメモを削除する。 |
| **F-04** | **メモ編集** | ✅ 完了 | タイトル・本文・画像の更新に対応。 |

### **2.2 認証・認可 (Auth)**

| ID | 機能名 | 実装状況 | 詳細 |
| :---- | :---- | :---- | :---- |
| **F-05** | **ユーザー登録/ログイン** | ✅ 完了 | **Clerk** を用いたセキュアな認証（Googleログイン等）。 |
| **F-06** | **データ分離** | ✅ 完了 | userId によるアクセス制御。他人のメモへのアクセスを401/404で遮断。 |

### **2.3 AI・高度機能 (Advanced Features)**

| ID | 機能名 | 実装状況 | 詳細 |
| :---- | :---- | :---- | :---- |
| **F-07** | **AI 自動要約** | ✅ 完了 | OpenAI API (またはMock) を利用し、長文メモを要約保存する。 |
| **F-08** | **ベクトル検索 (RAG)** | ✅ 完了 | **pgvector** を利用し、意味検索を実現する。 |
| **F-09** | **MCP サーバー連携** | 未実装 | AI エージェントからメモを操作可能にするインターフェース。 |

## **3\. 非機能要件 (Non-Functional Requirements)**

### **3.1 セキュリティ & インフラ**

* **機密情報**: .env 管理を徹底し、コードベースに含めない。AWSアクセスキーも同様。  
* **入力値検証**: Zod による厳格なバリデーションを実施。  
* **可用性**: AWS App Runner (コンテナ) \+ RDS (DB) \+ S3 (ストレージ) の構成を想定。

### **3.2 品質・保守性**

* **型安全性**: TypeScript を全面採用し、any 型の使用を原則禁止する。  
* **アーキテクチャ**: 「関心の分離」に基づき、ルーティング、コントローラー、サービス層を分離する。  
* **テスト**: Vitest (単体) / Playwright (E2E) の実装。

### **3.3 パフォーマンス目標**

* **API レスポンス**: 通常の CRUD 操作は **500ms 以内** にレスポンスを返すこと。  
* **AI 処理**: 時間のかかる AI 処理（数秒〜）は非同期で行い、UI をブロックしないこと。

## **4\. UI/UX ガイドライン (User Interface & Experience)**

### **4.1 デザイン原則**

* **モバイルファースト**: レスポンシブ対応。  
* **インタラクティブ**: AI処理中の「Thinking...」表示や、検索結果の類似度スコア表示。

### **4.2 画面構成**

1. **認証画面**: Clerk Hosted UI または カスタムコンポーネント。  
2. **ダッシュボード**:  
   * メモ一覧（画像サムネイル付き）。  
   * 検索バー（ベクトル検索対応）。  
   * ユーザーメニュー（アイコンクリックでログアウト等）。  
3. **編集・詳細画面**:  
   * 画像アップロードプレビュー。  
   * AI要約ボタンと結果表示エリア。

## **5\. システム設計詳細 (System Design)**

### **5.1 技術スタック**

* **Frontend**: React (Vite), Axios, Tailwind CSS, Clerk SDK  
* **Backend**: **Node.js (Hono)**, Prisma, OpenAI SDK  
* **Database**: PostgreSQL 16 (**pgvector** extension enabled)  
* **Storage**: **MinIO** (Local) / AWS S3 (Prod)  
* **Infrastructure**: Docker Compose, **Dev Containers**, Docker (Multi-stage Build), AWS (App Runner, ECR, RDS), AWS CLI  
* **Language**: TypeScript

### **5.2 データモデル (ER Diagram)**

erDiagram  
    User ||--o{ Memo : "owns"  
    User {  
        string id PK "Clerk User ID"  
        string email  
    }  
    Memo {  
        int id PK  
        string userId "Indexed for RLS-like logic"  
        string title  
        string content  
        string imageUrl "S3/MinIO URL"  
        vector embedding "vector(1536)"  
        datetime createdAt  
        datetime updatedAt  
    }

### **5.3 ディレクトリ構成 (Refactored)**

backend/src/  
├── config/ \# 環境変数読み込み  
├── controllers/ \# memoController.ts (Context 'c' handling)  
├── routes/ \# memoRoutes.ts (Hono routing definition)  
├── services/ \# memoService.ts, aiService.ts, storageService.ts  
├── validators/ \# memoValidator.ts (Zod schemas)  
├── utils/ \# prismaClient.ts  
└── index.ts \# Entry point (@hono/node-server)

### **5.4 API インターフェース詳細**

Base URL: /api/memos (Requires Bearer Token)

| Method | Endpoint | Body (Type) | Response | 備考 |
| :---- | :---- | :---- | :---- | :---- |
| GET | / | \- | Memo\[\] | ユーザー自身のメモ全件 |
| GET | /search | ?q={query} | { success, count, results } | **ベクトル検索** (高優先度) |
| POST | / | FormData | Memo | 画像アップロード対応 |
| PUT | /:id | FormData | Memo | 更新 |
| DELETE | /:id | \- | { success: true } | 削除 |
| POST | /:id/summarize | \- | { summary: string } | AI要約 |

## **6\. 開発運用ルール (Development & Operations Rules)**

### **6.1 環境分離 (Environment Isolation)**

* **Dev Containers**: ホストマシン（Mac）には Node.js や npm をインストールせず、全ての開発作業を Docker コンテナ内で行うことを絶対ルールとする。  
* **AWS 操作**: AWS CLI は開発用コンテナ (backend) にインストールし、ホストマシンの環境を汚さずにクラウド操作を行う。認証情報は .env で管理する。  
* **VS Code**: 拡張機能（ESLint, Prettier 等）もコンテナ内に定義し、開発者間で環境差異が生まれないようにする。

### **6.2 ビルド戦略 (Build Strategy)**

* **マルチステージビルド**: 本番用イメージ (Dockerfile.prod) はビルドステージと実行ステージを分離し、ソースコードや開発ツールを含まない軽量な状態にする。  
* **コンテナレジストリ**: 本番イメージは Amazon ECR で管理し、App Runner へデプロイする。  
* **非ルート実行**: 本番コンテナはセキュリティのため、非特権ユーザー (node) で実行する。

### **6.3 バージョン管理・ブランチ戦略**

* **フロー**: GitHub Flow (main \+ feature ブランチ)。  
* **コミットメッセージ**: Feat:, Fix:, Refactor:, Docs: 等のプレフィックスを付与する。

### **6.4 エラーハンドリング設計**

API は以下の HTTP ステータスコードを適切に返却し、フロントエンドはこれに基づいて UI を制御する。

| コード | 意味 | フロントエンドの挙動 |
| :---- | :---- | :---- |
| **200/201** | OK/Created | 成功メッセージを表示または画面遷移。 |
| **400** | Bad Request | 入力エラー箇所をハイライト表示（Zod 連携）。 |
| **401** | Unauthorized | ログイン画面へリダイレクト。 |
| **404** | Not Found | 404 ページまたは一覧へリダイレクト。 |
| **500** | Internal Error | 「システムエラーが発生しました」とトースト表示。 |

## **7\. 制約事項・前提条件 (Constraints)**

* **ブラウザサポート**: Google Chrome, Safari, Edge, Firefox の最新版のみをサポート対象とする（IE 等は非対応）。  
* **言語対応**: 日本語のみとする。  
* **依存サービス**: OpenAI API 等の外部サービスが停止した場合、AI 機能は利用不可となるが、基本的なメモ機能は継続して利用できる設計とする（Graceful Degradation）。

Created by \[Your Name\] \- 2025