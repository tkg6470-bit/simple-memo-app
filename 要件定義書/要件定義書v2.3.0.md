# ---

**📋 要件定義書 (System Requirements Specification)**

**Project Name:** Simple Memo App (Ultimate Edition)

**Version:** 2.3.0 (Feature Complete Edition)

**Last Updated:** 2025-12-10

本ドキュメントは、モダンな自社開発企業が採用する技術スタックと開発フローを再現した、フルスタックメモアプリケーションの要件を定義するものである。  
v2.3.0では、F-04（メモ編集機能）の実装完了により、アプリケーションとしての主要機能（CRUD）が全て揃った状態（Feature Complete）となった。また、クロスプラットフォーム環境（macOS/Windows ⇄ Linux）におけるビルド安定性も確保されている。

## ---

**1\. プロジェクト概要**

### **1.1 目的**

* **技術力の証明**: モダン技術（TypeScript, Docker, Cloud-Native, AI 連携）に加え、**Hono RPC による型安全な通信** と **Render Blueprint によるインフラ自動化** を運用する能力を証明する。  
* **実用性**: 基本的なメモ機能に加え、AIによる付加価値（要約・検索）を提供する。

### **1.2 予算戦略**

* **開発・運用フェーズ**: 完全無料  
  * **Compute**: Render (Free Tier) \- Docker コンテナ実行 (Managed by render.yaml)  
  * **Database**: Supabase (Free Tier) \- PostgreSQL  
  * **Storage**:  
    * Production: Supabase Storage (Free Tier)  
    * Local: **MinIO** (Docker)  
  * **Auth**: Clerk (Free Tier)  
  * **CI/CD**: GitHub Actions (Free Tier)

## ---

**2\. 機能要件 (Functional Requirements)**

### **2.1 基本機能 (Core Features)**

| ID | 機能名 | 実装状況 | 詳細 |
| :---- | :---- | :---- | :---- |
| **F-01** | **メモ作成** | ✅ 完了 | タイトル・本文・**画像**を入力し保存する。画像は環境に応じて **MinIO/Supabase** へ振り分け保存。 |
| **F-02** | **メモ閲覧** | ✅ 完了 | 作成日順での一覧表示。 |
| **F-03** | **メモ削除** | ✅ 完了 | 不要なメモを削除する。 |
| **F-04** | **メモ編集** | ✅ 完了 | 既存メモのタイトル・本文・画像の更新（PUT）。画像のみの差し替えも可能。編集モーダルUIを採用。 |

### **2.2 認証・認可 (Auth)**

| ID | 機能名 | 実装状況 | 詳細 |
| :---- | :---- | :---- | :---- |
| **F-05** | **ユーザー登録/ログイン** | ✅ 完了 | **Clerk** を用いたセキュアな認証。 |
| **F-06** | **データ分離** | ✅ 完了 | userId によるアクセス制御。他人のメモは見えない/編集できない。 |

### **2.3 AI・高度機能 (Advanced Features)**

| ID | 機能名 | 実装状況 | 詳細 |
| :---- | :---- | :---- | :---- |
| **F-07** | **AI 自動要約** | ✅ 完了 | OpenAI API (Mock可) を利用し、長文メモを要約保存する。 |
| **F-08** | **ベクトル検索 (RAG)** | ✅ 完了 | **pgvector** を利用し、意味検索を実現する。 |

## ---

**3\. 非機能要件 (Non-Functional Requirements)**

### **3.1 セキュリティ & インフラ**

* **IaC (Infrastructure as Code)**: render.yaml によりサービス構成（Web Service, Docker設定, 環境変数リンク）をコード管理する。  
* **機密情報**: APIキーやDB接続情報はコードに含めず、Render Dashboard の **Environment Groups** で管理する。  
* **可用性 & 互換性**:  
  * **Cross-Platform Build**: ローカル(macOS/Win)と本番(Linux)のアーキテクチャ差異を吸収するため、optionalDependencies (@rollup/linux-x64-gnu 等) を明示的に管理する。  
  * **Auto Migration**: デプロイ時に自動で prisma migrate deploy を実行する。

### **3.2 品質・保守性**

* **Strict Type Safety**:  
  * **No Implicit Any**: any 型の使用を原則禁止し、Lintでエラーとして検出する。  
  * **End-to-End**: Hono RPC によりバックエンド/フロントエンド間の型定義を共有する。  
* **Dependency Locking**: package-lock.json を必須とし、CI環境での依存関係の完全一致を保証する。  
* **自動化 (CI)**: GitHub Actions により、Lint と Type Check を自動実行する。

### **3.3 パフォーマンス目標**

* **API レスポンス**: 通常の CRUD 操作は **500ms 以内** にレスポンスを返すこと。

## ---

**4\. UI/UX ガイドライン**

* **デザイン**: シンプルかつ直感的。過度な装飾を避け、コンテンツ（メモ）を見やすく配置する。  
* **フィードバック**: 保存中・削除中・AI処理中などのステータスをユーザーに明示する（Loading表示など）。

## ---

**5\. システム設計詳細 (System Design)**

### **5.1 技術スタック**

* **Frontend**: React (Vite), **Hono Client (RPC)**, Clerk SDK  
* **Backend**: **Node.js (Hono)**, Prisma (v5.22.0 Fixed), OpenAI SDK  
* **Database**: **Supabase (PostgreSQL 16\)** (pgvector enabled)  
* **Infrastructure**:  
  * Local: Docker Compose  
  * Prod: **Render Blueprint (IaC)**  
* **Storage**: MinIO (Local) / Supabase Storage (Prod)

### **5.2 ディレクトリ構成 & 主要アーキテクチャ**

* **render.yaml**: ルートディレクトリに配置し、バックエンド・フロントエンド双方のビルドコンテキストを制御する。  
* **frontend/src/client.ts**: 環境変数 (VITE\_API\_URL) の正規化処理を実装し、Hono RPC クライアントを生成する。

## ---

**6\. 開発運用ルール**

### **6.1 環境分離 (Environment Isolation)**

* **Docker 運用**:  
  * バックエンドは npm run dev コマンドでコンテナ起動時に自動立ち上げを行う。  
  * Render環境では Dockerfile に基づき dist 生成とマイグレーションを自動実行する。

### **6.2 シークレット管理**

* **Config (非機密)**: render.yaml に記述（NODE\_ENV, PORT 等）。  
* **Secrets (機密)**: Render Dashboard の Environment Groups に記述。  
* **禁止事項**: .env ファイルや render.yaml に生のシークレット値をコミットしない。

### **6.3 CI/CD パイプライン**

* **Trigger**: main ブランチへの Push または Pull Request。  
* **Checks**:  
  * **Backend Check**: ESLint \+ tsc (Type Check)。  
  * **Frontend Check**: ESLint (React Rules) \+ tsc (Type Check)。  
* **Render Auto Deploy**: CI 通過後、main マージをトリガーに自動デプロイ。

## ---

**7\. 開発・運用コマンド (Cheat Sheet) 🛠️**

開発時によく使用するコマンド一覧。困ったときはここを確認すること。

### **7.1 Docker コンテナ操作（必須）**

コンテナの中に入って、ファイル確認やコマンド実行を行いたい場合に使用する。  
※ \-it オプションを忘れると操作できないので注意。

| 対象 | コマンド | 用途 |
| :---- | :---- | :---- |
| **Backend** | docker compose exec \-it \-u root backend /bin/sh | バックエンド環境に入る (Prisma操作など) |
| **Frontend** | docker compose exec \-it \-u root frontend /bin/sh | フロントエンド環境に入る (npm installなど) |
| **MinIO** | docker compose exec \-it minio /bin/sh | ストレージ環境に入る |

### **7.2 データベース操作 (Prisma)**

開発中にDBスキーマを変更したり、データを確認する場合。

| 動作 | コマンド (Backendコンテナ内 または ホスト側) |
| :---- | :---- |
| **マイグレーション** | npx prisma migrate dev \--name \<変更名\> |
| **GUIでデータ確認** | npx prisma studio (ホスト側で実行推奨) |
| **クライアント生成** | npx prisma generate |

### **7.3 ログ確認**

エラーが出た際に、コンテナのログをリアルタイムで監視する。

| 動作 | コマンド |
| :---- | :---- |
| **Backendログ** | docker compose logs \-f backend |
| **Frontendログ** | docker compose logs \-f frontend |
| **全ログ** | docker compose logs \-f |

### **7.4 Git / デプロイ手順**

機能修正を行い、本番環境へ反映させる手順。

1. **変更をステージング**: git add .  
2. **コミット**: git commit \-m "feat(機能名): 内容の説明"  
3. **プッシュ (デプロイ開始)**: git push origin main

Created by \[tkg\] \- 2025