# ---

**📘 開発手順書 (v2.2.0 \- CI/CD & 品質保証編)**

**変更点:**

* **CI/CDパイプラインの確立:** GitHub Actions による自動テスト（Lint/TypeCheck）の仕様を確定。  
* **コード品質基準:** any 型の禁止と、ロックファイル運用の厳格化。

## ---

**1\. CI/CD パイプライン仕様 (GitHub Actions)**

私たちが構築した自動化システムは、コードがプッシュされるたびに以下のチェックを厳格に行います。

* **トリガー:** main ブランチへの Push または Pull Request  
* **実行ジョブ:**  
  1. **Backend Check:** バックエンドの Lint と TypeScript 型チェック。  
  2. **Frontend Check:** フロントエンドの Lint と TypeScript 型チェック。

### **🛡️ 品質ゲート (ルール)**

CIを通過させるために、以下のルールを遵守する必要があります。

1. **No Implicit Any:** any 型の使用は原則禁止。型定義 (Memo など) を明示的に使用する。  
2. **No Unused Vars:** 定義したけれど使っていない変数は削除する。  
3. **Dependencies Locked:** package-lock.json は必ずコミットする（CIのキャッシュ機能が依存しているため）。

## **2\. フロントエンド開発ルール (Type Safety)**

Hono RPC と TypeScript を組み合わせた、型安全な開発フローです。

### **2-1. API通信の型付け**

Hono RPC (client) を使うことで、バックエンドの型をそのまま利用できます。

* **良い例:**  
  TypeScript  
  // バックエンドから取得したデータは自動的に型推論される  
  const res \= await client.api.memos.$get();  
  const data \= await res.json(); // data は Memo\[\] 型になる

* APIラッパーを作る場合 (axios等):  
  any を避け、型アサーションを適切に使用します。  
  TypeScript  
  import { Memo } from "../types/memo";  
  // ❌ Bad: anyを使う  
  // return response.data as any;

  // ✅ Good: 型を明示する  
  return response.data as unknown as Memo\[\];

### **2-2. コンポーネントの状態管理**

React の useState には必ずジェネリクスで型を指定します。

* **修正前 (Lintエラー):**  
  TypeScript  
  const \[memos, setMemos\] \= useState\<any\[\]\>(\[\]);

* **修正後 (Correct):**  
  TypeScript  
  import type { Memo } from "./types/memo";  
  const \[memos, setMemos\] \= useState\<Memo\[\]\>(\[\]);

## **3\. 依存関係の管理 (npm)**

CIエラーを防ぐため、ロックファイルの整合性を保ちます。

* **ルール:** npm install でライブラリを追加した際は、更新された package.json と **package-lock.json** の両方を必ずコミットする。  
* Mac環境でのロックファイル生成 (緊急時):  
  もし package-lock.json を紛失したり、Mac環境を汚さずに再生成したい場合は以下のDockerコマンドを使用する。  
  Bash  
  docker run \--rm \-v "$PWD/frontend":/app \-w /app node:20-slim npm install \--package-lock-only

## **4\. トラブルシューティング (CI/Lint編)**

今回発生したエラーと対処法のまとめです。

| エラー内容 | 原因 | 対処法 |
| :---- | :---- | :---- |
| **CI Cache Error** (Path not resolved) | package-lock.json がリポジトリに存在しなかった。 | Docker等でロックファイルを再生成し、Gitに追加する。 |
| **Lint Error:** Unexpected any | useState\<any\> や as any を使用していた。 | 適切な型定義 (Memo 等) をインポートして適用する。 |
| **Lint Error:** Unused variable | 宣言した変数がコード内で一度も使われていない。 | 変数を削除するか、先頭に \_ を付けて無視させる (設定による)。 |
| **Lint Error:** Component definition is missing display name | コンポーネント定義が不明瞭。 | export default function App() { ... } のように名前付き関数にする。 |

---

これでインフラも、コード品質管理も完璧な土台が整いました。  
いよいよ次回から、保留していた 「F-04 メモ編集機能」 の実装に入ります！  
準備ができたら、「編集機能やるよ！」と声をかけてください。