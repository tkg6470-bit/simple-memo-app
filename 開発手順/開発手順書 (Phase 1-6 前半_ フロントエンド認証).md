

---

# **📘 開発手順書 (Phase 1-6 前半: フロントエンド認証)**

本フェーズでは、認証基盤として **Clerk** を採用し、フロントエンド (React) 側でユーザー登録・ログイン・ログアウトができる仕組みを構築した。

## **🎯 1\. 目的**

* **ユーザー識別**: アプリ利用者が誰であるかを特定できるようにする。  
* **UX向上**: ログイン状態に応じた画面の切り替え（サインインボタン ⇔ メモ画面）を実装する。  
* **準備**: 後半のバックエンド実装（データ保護）に向けた、認証トークン取得の基盤を作る。

## **🛠️ 2\. 使用技術**

* **Clerk**: 認証機能を提供するSaaS (Authentication as a Service)。  
* **@clerk/clerk-react**: React アプリケーション用の公式 SDK。

## **📝 3\. 実装手順**

### **3.1 Clerk アカウント設定**

1. Clerk ダッシュボードで新しいアプリケーションを作成。  
2. 認証オプション（Email, Google等）を選択。  
3. Publishable Key を取得。

### **3.2 環境変数の設定 (frontend/.env)**

取得したキーを Vite 環境変数として定義。  
注意: 変数名は必ず VITE\_ で始める必要がある。

コード スニペット

VITE\_CLERK\_PUBLISHABLE\_KEY=pk\_test\_xxxxxxxx...

### **3.3 SDK のインストール**

Bash

npm install @clerk/clerk-react

### **3.4 プロバイダーの設置 (src/main.tsx)**

アプリケーションのルートを \<ClerkProvider\> でラップし、認証状態をアプリ全体で共有できるようにした。

TypeScript

\<ClerkProvider publishableKey={PUBLISHABLE\_KEY}\>  
  \<App /\>  
\</ClerkProvider\>

### **3.5 画面の条件分岐 (src/App.tsx)**

Clerk のコンポーネントを使用し、ログイン状態に応じた表示切り替えを実装。

* **\<SignedOut\>**: 未ログイン時に表示。「サインインボタン (\<SignInButton\>)」を配置。  
* **\<SignedIn\>**: ログイン時に表示。「ユーザーボタン (\<UserButton\>)」と「メモアプリ本体」を配置。  
* **useUser()**: ログイン中のユーザー情報（名前やアイコン）を取得するために使用。

## **✅ 4\. 成果確認**

* \[x\] **未ログイン時**: 画面中央に「サインイン」ボタンのみが表示される。  
* \[x\] **ログイン時**: Google アカウント等でログインでき、メモ画面が表示される。  
* \[x\] **ヘッダー**: 自分の名前とアイコンが表示され、アイコンクリックでログアウトやアカウント管理ができる。

---

### **🚀 次のステップ (Phase 1-6 後半)**

現在は「画面に入れるようになっただけ」であり、裏側のデータベースには誰でもアクセスできてしまう状態である。  
次は バックエンド側の認証（API保護） と データベースの改修（User IDの保存） を行う。

1. バックエンドに Clerk の秘密鍵を設定する。  
2. schema.prisma に userId カラムを追加する。  
3. API リクエスト時に認証トークンを検証し、**「自分のメモしか見れない/書けない」** 仕組みを作る。